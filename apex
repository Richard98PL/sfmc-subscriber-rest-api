public without sharing class MarketingCloudRequest {
    @AuraEnabled
    public static String send(String email){
        return assignToNewsletter(getToken(), email);
    }

    public class AuthWrapper{
        String grant_type;
        String client_id;
        String client_secret;
    }

    public class ResponseWrapper{
        public String access_token;
    }
    public static String getToken(){
        HttpRequest req = new HttpRequest();
        req.setEndpoint('...1.auth.marketingcloudapis.com/v2/token');
        req.setMethod('POST');

        AuthWrapper wrapper = new AuthWrapper();
        wrapper.grant_type = 'client_credentials';
        wrapper.client_id = '...';
        wrapper.client_secret = '...';

        req.setHeader('Content-Type', 'application/json');

        req.setBody(JSON.serialize(wrapper));

        Http http = new Http();

        HTTPResponse res = http.send(req);

        String body = res.getBody();
        Object response = JSON.deserialize(body, ResponseWrapper.class);
        return String.valueOf(((ResponseWrapper)response).access_token);
    }

    //
//Generated by AdminBooster
//

    public class NewsletterWrapper{
        public String contactKey;	//ryszardd@genus.one
        public List<AttributeSet> attributeSets = new List<AttributeSet>();
    }

    public class AttributeSet {
        public String name;
        public List<Items> items= new List<Items>();
    }

    public class Items {
        public List<Values> values = new List<Values>();
    }

    public class Values {
        public String name;	//Email Address
        public String value;	//ryszardd@genus.one
    }


    public static String assignToNewsletter(String token, String email){
        HttpRequest req = new HttpRequest();
        req.setEndpoint('https://...rest.marketingcloudapis.com/contacts/v1/contacts');
        req.setMethod('POST');

        req.setHeader('Content-Type', 'application/json');
        req.setHeader('Authorization', 'Bearer ' + token);

        Values newsletterValue = new Values();
        newsletterValue.name = 'Newsletter';
        newsletterValue.value = 'true';

        Values htmlValue = new Values();
        htmlValue.name = 'HTML Enabled';
        htmlValue.value = 'true';

        Values emailValue = new Values();
        emailValue.name = 'Email Address';
        emailValue.value = email;

        Items firstItem = new Items();
        firstItem.values.add(emailValue);
        firstItem.values.add(htmlValue);

        Items secondItem = new Items();
        secondItem.values.add(newsletterValue);

        AttributeSet firstAttributeSet = new AttributeSet();
        firstAttributeSet.name = 'Email Addresses';
        firstAttributeSet.items.add(firstItem);

        AttributeSet secondAttributeSet = new AttributeSet();
        secondAttributeSet.name = 'Email Demographics';
        secondAttributeSet.items.add(secondItem);

        NewsletterWrapper wrapper = new NewsletterWrapper();
        wrapper.contactKey = email;
        wrapper.attributeSets.add(firstAttributeSet);
        wrapper.attributeSets.add(secondAttributeSet);
        //return JSON.serialize(wrapper);

        req.setBody(JSON.serialize(wrapper));

        Http http = new Http();

        HTTPResponse res = http.send(req);

        String body = res.getBody();
        return String.valueOf(body);
    }
}
